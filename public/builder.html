<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integra AI Builder</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Custom Tailwind Configuration to define primary and secondary colors
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#1b84ff', // Bright Blue
                        'secondary': '#35495e', // Deep Slate
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            }
        }
    </script>
    <style>
        /* Ensuring Inter font loads for compatibility */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
    </style>
</head>
<body class="bg-secondary/5 text-secondary min-h-screen p-4 sm:p-8 font-sans">
 <div class="max-w-xl mx-auto py-8">
        <!-- Header -->
        <h1 class="text-3xl sm:text-4xl font-extrabold text-secondary mb-8 border-b-2 border-primary pb-2 text-center">
            Creare chat Integra AI
        </h1>

        <!-- Chat Form Container -->
        <div class="bg-white p-6 sm:p-8 rounded-xl shadow-2xl shadow-secondary/10 border border-gray-100">
            <form id="chatForm" class="space-y-6">
                <!-- Chatbot Name -->
                <div>
                    <label for="name" class="block text-sm font-semibold text-secondary mb-1">Nume chatbot:</label>
                    <input type="text" name="name" id="name" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition duration-150 ease-in-out placeholder-gray-500 hover:border-primary/50">
                </div>

                <!-- LLM Model -->
                <div>
                    <label for="model" class="block text-sm font-semibold text-secondary mb-1">Model LLM:</label>
                    <select name="model" id="model" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none bg-white transition duration-150 ease-in-out hover:border-primary/50">
                        <option value="gpt-oss:20b">gpt-oss:20b</option>
                        <option value="gemma:2b">gemma:2b</option>
                        <option value="mistral">mistral</option>
                    </select>
                </div>

                <!-- System Prompt -->
                <div>
                    <label for="prompt" class="block text-sm font-semibold text-secondary mb-1">Prompt (instruc»õiuni sistem):</label>
                    <textarea name="prompt" id="prompt" rows="6" placeholder="Cum trebuie sƒÉ se comporte AI-ul..." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition duration-150 ease-in-out placeholder-gray-500 hover:border-primary/50"></textarea>
                </div>

                <!-- Chat Title -->
                <div>
                    <label for="chat_title" class="block text-sm font-semibold text-secondary mb-1">Titlu chat (apare √Æn header):</label>
                    <input type="text" name="chat_title" id="chat_title" placeholder="Ex: Integra AI" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition duration-150 ease-in-out placeholder-gray-500 hover:border-primary/50">
                    <p class="text-xs text-gray-500 mt-1">LƒÉsa»õi gol pentru a folosi numele chatbot-ului</p>
                </div>

                <!-- Chat Subtitle -->
                <div>
                    <label for="chat_subtitle" class="block text-sm font-semibold text-secondary mb-1">Subtitlu chat:</label>
                    <input type="text" name="chat_subtitle" id="chat_subtitle" placeholder="Ex: Asistentul tƒÉu inteligent pentru gƒÉsirea informa»õiilor" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition duration-150 ease-in-out placeholder-gray-500 hover:border-primary/50">
                </div>

                <!-- Chat Color -->
                <div>
                    <label for="chat_color" class="block text-sm font-semibold text-secondary mb-1">Culoare principalƒÉ chat:</label>
                    <div class="flex items-center gap-4">
                        <input type="color" name="chat_color" id="chat_color" value="#3b82f6" class="w-20 h-12 border border-gray-300 rounded-lg cursor-pointer">
                        <input type="text" id="chat_color_text" value="#3b82f6" placeholder="#3b82f6" class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition duration-150 ease-in-out">
                    </div>
                    <p class="text-xs text-gray-500 mt-1">Culoarea folositƒÉ pentru header, butoane »ôi elemente interactive</p>
                </div>

                <!-- RAG Files -->
                <div>
                    <label for="rag_files" class="block text-sm font-semibold text-secondary mb-1">Fi»ôiere RAG (op»õional):</label>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-primary/50 transition duration-150">
                        <input type="file" name="rag_files" id="rag_files" multiple accept=".pdf,.txt,.doc,.docx,.md" class="hidden">
                        <label for="rag_files" class="cursor-pointer">
                            <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            <span class="mt-2 block text-sm font-medium text-gray-700">
                                Click pentru a selecta fi»ôiere
                            </span>
                            <span class="mt-1 block text-xs text-gray-500">
                                PDF, TXT, DOC, DOCX, MD (max 10MB per fi»ôier)
                            </span>
                        </label>
                        <div id="rag_files_list" class="mt-4 text-left space-y-2"></div>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">Fi»ôierele vor fi folosite pentru RAG (Retrieval Augmented Generation) - con»õinutul lor va fi disponibil pentru AI</p>
                </div>

                <!-- Generate Button -->
                <button type="submit" class="w-full bg-primary text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition duration-300 ease-in-out shadow-lg shadow-primary/50 transform hover:scale-[1.01] active:scale-[0.99] focus:outline-none focus:ring-4 focus:ring-primary/50">
                    GenereazƒÉ chat
                </button>
            </form>
        </div>

        <!-- Output Area -->
        <div class="output mt-8 p-6 bg-secondary/10 border-l-4 border-primary rounded-xl" id="output">
            <p class="text-secondary/80">Rezultatul generƒÉrii va apƒÉrea aici.</p>
        </div>
    </div>

  <script>
    // SincronizeazƒÉ color picker cu input text
    document.getElementById('chat_color').addEventListener('input', (e) => {
        document.getElementById('chat_color_text').value = e.target.value;
    });
    
    document.getElementById('chat_color_text').addEventListener('input', (e) => {
        const color = e.target.value;
        if (/^#[0-9A-F]{6}$/i.test(color)) {
            document.getElementById('chat_color').value = color;
        }
    });

    // GestioneazƒÉ lista de fi»ôiere RAG
    document.getElementById('rag_files').addEventListener('change', (e) => {
        const files = Array.from(e.target.files);
        const listDiv = document.getElementById('rag_files_list');
        
        if (files.length === 0) {
            listDiv.innerHTML = '';
            return;
        }
        
        listDiv.innerHTML = '<p class="text-sm font-medium text-gray-700 mb-2">Fi»ôiere selectate:</p>';
        files.forEach((file, index) => {
            const fileItem = document.createElement('div');
            fileItem.className = 'flex items-center justify-between p-2 bg-gray-50 rounded border border-gray-200';
            fileItem.innerHTML = `
                <div class="flex items-center gap-2">
                    <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <span class="text-sm text-gray-700">${file.name}</span>
                    <span class="text-xs text-gray-500">(${(file.size / 1024 / 1024).toFixed(2)} MB)</span>
                </div>
            `;
            listDiv.appendChild(fileItem);
        });
    });

    // Function to copy text to clipboard
        function copyToClipboard(elementId, statusElementId) {
            const copyText = document.getElementById(elementId);
            const statusDiv = document.getElementById(statusElementId);
            
            // Select the text field
            copyText.select();
            copyText.setSelectionRange(0, 99999); // For mobile devices

            try {
                // Try modern clipboard API first
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(copyText.value).then(() => {
                        statusDiv.innerText = 'Copiat!';
                        statusDiv.classList.remove('opacity-0', 'text-red-500');
                        statusDiv.classList.add('text-primary');
                        setTimeout(() => {
                            statusDiv.classList.add('opacity-0');
                            statusDiv.innerText = '';
                        }, 2000);
                    }).catch(() => {
                        // Fallback to execCommand
                        document.execCommand('copy');
                        statusDiv.innerText = 'Copiat!';
                        statusDiv.classList.remove('opacity-0', 'text-red-500');
                        statusDiv.classList.add('text-primary');
                        setTimeout(() => {
                            statusDiv.classList.add('opacity-0');
                            statusDiv.innerText = '';
                        }, 2000);
                    });
                } else {
                    // Fallback to execCommand
                    document.execCommand('copy');
                    statusDiv.innerText = 'Copiat!';
                    statusDiv.classList.remove('opacity-0', 'text-red-500');
                    statusDiv.classList.add('text-primary');
                    setTimeout(() => {
                        statusDiv.classList.add('opacity-0');
                        statusDiv.innerText = '';
                    }, 2000);
                }
            } catch (err) {
                statusDiv.innerText = 'Eroare la copiere!';
                statusDiv.classList.remove('opacity-0', 'text-primary');
                statusDiv.classList.add('text-red-500');
                console.error('Copy failed: ', err);
            }
        }
  document.getElementById("chatForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const form = e.target;
            const formData = new FormData(form);
            const outputDiv = document.getElementById("output");
            
            // AdaugƒÉ fi»ôierele RAG la FormData
            const ragFiles = document.getElementById('rag_files').files;
            for (let i = 0; i < ragFiles.length; i++) {
                formData.append('rag_files', ragFiles[i]);
            }
            
            // Add loading state
            outputDiv.innerHTML = `
                <div class="flex items-center space-x-2 text-primary">
                    <svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span class="font-medium">Se genereazƒÉ chatul...</span>
                </div>
            `;
            
      
            
            const res = await fetch("/builder/create", { method: "POST", body: formData });
            const data = await res.json();
          
            // VerificƒÉ starea fi»ôierelor RAG
            const ragInfo = data.config?.rag_content_info || [];
            const ragStatus = ragInfo.length > 0 
                ? ragInfo.filter(f => f.has_content).length + " din " + ragInfo.length + " fi»ôiere procesate cu succes"
                : "Niciun fi»ôier RAG";
            
            // Update output with results
            outputDiv.innerHTML = `
                <h3 class="text-xl font-bold text-primary mb-3">Chat generat cu succes!</h3>
                <p class="text-sm font-mono bg-white p-2 rounded-md mb-2"><strong>ID:</strong> ${data.chat_id}</p>
                
                ${ragInfo.length > 0 ? `
                <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                    <p class="text-sm font-semibold text-blue-800 mb-1">üìÑ Fi»ôiere RAG:</p>
                    <p class="text-xs text-blue-700">${ragStatus}</p>
                    ${ragInfo.some(f => !f.has_content) ? `
                    <p class="text-xs text-orange-600 mt-2">
                        ‚ö†Ô∏è Unele fi»ôiere nu au putut fi procesate. 
                        <a href="/chat/${data.chat_id}/reprocess-rag" target="_blank" class="underline">Re-proceseazƒÉ fi»ôierele</a>
                    </p>
                    ` : ''}
                </div>
                ` : ''}
                
                <div class="mt-4 p-4 bg-gradient-to-r from-primary/10 to-blue-50 border border-primary/20 rounded-lg">
                    <p class="text-sm font-semibold text-secondary mb-2">üîó Link chat:</p>
                    <div class="flex items-center gap-2">
                        <input 
                            type="text" 
                            id="chat-url" 
                            value="${window.location.origin}${data.chat_url}" 
                            readonly 
                            class="flex-1 p-2 border border-gray-300 rounded-lg bg-white font-mono text-sm"
                        />
                        <button 
                            type="button" 
                            onclick="copyToClipboard('chat-url', 'copy-status')" 
                            class="shrink-0 bg-primary text-white text-sm font-semibold px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-150 ease-in-out"
                            title="CopiazƒÉ link-ul"
                        >
                            CopiazƒÉ
                        </button>
                    </div>
                    <span id="copy-status" class="text-xs font-semibold opacity-0 transition-opacity duration-500 block mt-2"></span>
                </div>
                
                <div class="mt-4 flex gap-3">
                    <a 
                        href="${data.chat_url}" 
                        target="_blank" 
                        class="flex-1 bg-primary text-white font-semibold py-3 px-4 rounded-lg hover:bg-blue-700 transition duration-150 ease-in-out text-center"
                    >
                        Deschide chat full-page
                    </a>
                </div>
            `;
        });
  </script>
</body>
</html>
